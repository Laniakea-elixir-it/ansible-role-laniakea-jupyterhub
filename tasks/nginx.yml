---

- name: Install nginx
  apt:
    name: nginx
    state: present

- name: Configure reverse proxy for JupyterHub
  template:
    dest: "{{ jupyterhub_nginx_sites_available }}"
    src: jupyterhub_nginx.j2
  notify: Restart nginx

- name: Enable JupyterHub in nginx
  file:
    src: "{{jupyterhub_nginx_sites_available }}"
    dest: "{{ nginx_conf_dir }}/sites-enabled/jupyterhub"
    state: link
  notify: Restart nginx

- name: Configure nginx
  blockinfile:
    path: "{{ nginx_conf_dir }}/sites-available/default"
    block: |2
              map $http_upgrade $connection_upgrade {
                default upgrade;
                '' close;
              }
    insertbefore: ^server {
  notify: Restart nginx
    